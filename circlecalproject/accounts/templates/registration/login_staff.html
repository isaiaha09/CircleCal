{% extends "calendar_app/base.html" %}
{% load static %}

{% block main_class %}w-full max-w-none mx-0 px-0 py-0{% endblock %}

{% block title %}Staff | Manager | GM{% endblock %}

{% block content %}
<style>
	.cc-auth {
		--primary: #007bff;
		--primary-600: #0056b3;
		--card: #ffffff;
		--text: #1f2937;
		--muted: #6b7280;
		--border: #d1d5db;
		--success: #10b981;
		--danger: #ef4444;
		background: transparent;
		color: var(--text);
		width: 100%;
		padding: 24px;
		padding-left: calc(24px + env(safe-area-inset-left));
		padding-right: calc(24px + env(safe-area-inset-right));
	}
	.cc-auth * { box-sizing: border-box; }
	.cc-auth .card {
		width: 100%;
		max-width: 420px;
		margin: 24px auto;
		background: var(--card);
		border: 1px solid var(--border);
		border-radius: 16px;
		box-shadow: 0 8px 24px rgba(0,0,0,0.08);
		overflow: hidden;
	}
	.cc-auth .header { padding: 24px 24px 0 24px; text-align: center; }
	.cc-auth .title { margin: 0; font-size: 24px; font-weight: 700; }
	.cc-auth .subtitle { margin: 6px 0 0 0; color: var(--muted); font-size: 14px; }
	.cc-auth .content { padding: 24px; }
	.cc-auth .form-row { margin-bottom: 16px; }
	.cc-auth label { display: inline-block; margin-bottom: 8px; font-weight: 600; }
	.cc-auth .content input[type="text"],
	.cc-auth .content input[type="password"],
	.cc-auth .content input[type="number"],
	.cc-auth .content input[type="tel"],
	.cc-auth .content input[type="email"] {
		width: 100%; padding: 12px 14px; border: 2px solid #cfe0ff; border-radius: 10px; font-size: 15px; outline: none; transition: border-color .15s ease, box-shadow .15s ease; background: #fbfdff;
	}
	.cc-auth .content input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0,123,255,0.15); }
	.cc-auth .helper { color: var(--muted); font-size: 12px; margin-top: 6px; }
	.cc-auth .actions { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
	.cc-auth .btn { appearance: none; cursor: pointer; border: none; border-radius: 10px; padding: 12px 14px; font-weight: 700; font-size: 15px; transition: background-color .15s ease, transform .05s ease; }
	.cc-auth .btn-primary { background: var(--primary); color: #fff; }
	.cc-auth .btn-primary:hover { background: var(--primary-600); }
	.cc-auth .btn-primary:active { transform: translateY(1px); }
	.cc-auth .alt { text-align: center; font-size: 13px; color: var(--muted); }
	.cc-auth .alt a { color: var(--primary); text-decoration: none; }
	.cc-auth .alt a:hover { text-decoration: underline; }
	.cc-auth .errorlist { list-style: none; padding: 0; margin: 8px 0 0 0; color: var(--danger); font-size: 13px; }
	/* Mobile: keep centered without viewport-unit hacks */
	@media (max-width:640px) {
		.cc-auth {
			padding: 16px;
			padding-left: calc(16px + env(safe-area-inset-left));
			padding-right: calc(16px + env(safe-area-inset-right));
		}
		.cc-auth .card { border-radius: 10px; }
	}
</style>

<div class="cc-auth">
	<div class="card">
		<div class="header">
			<h1 class="title">Staff | Manager | GM</h1>
			<p class="subtitle">Log in to continue</p>
		</div>
		<div class="content">
			{% if request.GET.pwa_only %}
				<ul class="errorlist"><li>We couldn't log you in. Please try again.</li></ul>
			{% endif %}
			<form method="post" novalidate>
				{% csrf_token %}
				<input type="hidden" name="cc_pwa_standalone" id="cc_pwa_standalone" value="0" />
				{% include "two_factor/_wizard_forms_email.html" %}

				<div class="actions">
					<button type="submit" class="btn btn-primary">Login</button>
					<p class="alt">New here? <a href="{% url 'calendar_app:signup' %}">Create an account</a></p>
					<p class="alt" style="margin-top:6px;"><a href="{% url 'accounts:password_reset' %}">Forgot Password</a></p>
				</div>
			</form>
		</div>
	</div>
</div>

<script>
	(function () {
		// Best-effort signal that this session is in "standalone" PWA display mode.
		// This is not a security boundary; it only gates the convenience redirect to /admin
		// when a superuser logs in via this Staff/Manager login page.
		var isStandalone = false;
		try {
			isStandalone = window.matchMedia && window.matchMedia('(display-mode: standalone)').matches;
		} catch (e) {}
		try {
			// iOS Safari
			isStandalone = isStandalone || (typeof navigator !== 'undefined' && navigator.standalone === true);
		} catch (e) {}

		var secure = (typeof location !== 'undefined' && location.protocol === 'https:') ? '; Secure' : '';
		if (isStandalone) {
			document.cookie = 'cc_pwa_standalone=1; Path=/; SameSite=Lax' + secure;
			var el = document.getElementById('cc_pwa_standalone');
			if (el) el.value = '1';
		} else {
			// Clear the cookie in normal browser mode to avoid accidental carryover.
			document.cookie = 'cc_pwa_standalone=; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Path=/; SameSite=Lax' + secure;
			var el2 = document.getElementById('cc_pwa_standalone');
			if (el2) el2.value = '0';
		}
	})();
</script>
{% endblock %}