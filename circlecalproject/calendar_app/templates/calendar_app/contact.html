{% extends "calendar_app/base.html" %}
{% block title %}Contact{% endblock %}

{# Mobile-only: break out of base <main> constraints; keep normal base layout on sm+ #}
{% block main_class %}w-full max-w-none px-0 py-0 sm:max-w-6xl sm:mx-auto sm:px-4 sm:py-6 md:p-6{% endblock %}

{% block content %}
<div class="min-h-[60vh] flex items-center justify-center py-12">
    <div class="w-[95vw] mx-auto max-w-2xl sm:w-full">
        <div class="bg-white border border-blue-100 rounded-2xl shadow-lg p-8 text-left">
            <div class="text-center mb-6">
                <div class="inline-flex items-center gap-2 mb-2">
                    <span class="font-bold text-xl text-blue-600">CircleCal</span>
                    <span class="text-xs px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 border border-blue-200">Support</span>
                </div>
                <h1 class="text-3xl font-bold text-blue-700 mb-2">Contact</h1>
                <p class="text-sm text-gray-600">Send us a message and weâ€™ll get back to you as soon as we can.</p>
            </div>

            <form method="post" class="space-y-4">
                {% csrf_token %}

                {% if form.errors %}
                    <div class="px-4 py-3 rounded bg-red-100 text-red-800 text-sm text-center">
                        Please correct the errors below.
                    </div>
                {% endif %}

                {% if form.non_field_errors %}
                    <div class="px-4 py-3 rounded bg-red-100 text-red-800 text-sm text-center">
                        {{ form.non_field_errors.0 }}
                    </div>
                {% endif %}

                <div>
                    <label for="id_business_name" class="block text-sm font-medium text-gray-700 mb-1">Business Name</label>
                    <input
                        type="text"
                        name="business_name"
                        id="id_business_name"
                        value="{{ form.business_name.value|default_if_none:'' }}"
                        class="w-full px-4 py-3 text-base placeholder:text-sm border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-blue-50/30"
                        placeholder="Your business name (optional)"
                    >
                    {% if form.business_name.errors %}
                        <p class="mt-1 text-xs text-red-600">{{ form.business_name.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label for="id_name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                    <input
                        type="text"
                        name="name"
                        id="id_name"
                        required
                        value="{{ form.name.value|default_if_none:'' }}"
                        class="w-full px-4 py-3 text-base placeholder:text-sm border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-blue-50/30"
                        placeholder="Your name"
                    >
                    {% if form.name.errors %}
                        <p class="mt-1 text-xs text-red-600">{{ form.name.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label for="id_email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input
                        type="email"
                        name="email"
                        id="id_email"
                        required
                        value="{{ form.email.value|default_if_none:'' }}"
                        class="w-full px-4 py-3 text-base placeholder:text-sm border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-blue-50/30"
                        placeholder="you@email.com"
                    >
                    {% if form.email.errors %}
                        <p class="mt-1 text-xs text-red-600">{{ form.email.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label for="id_subject" class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
                    <select
                        name="subject"
                        id="id_subject"
                        class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-blue-50/30"
                        required
                    >
                        {% for value, label in form.fields.subject.choices %}
                            <option value="{{ value }}" {% if form.subject.value == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                    {% if form.subject.errors %}
                        <p class="mt-1 text-xs text-red-600">{{ form.subject.errors.0 }}</p>
                    {% endif %}
                </div>

                <div id="other-subject-wrap" class="hidden">
                    <label for="id_other_subject" class="block text-sm font-medium text-gray-700 mb-1">Other Subject</label>
                    <input
                        type="text"
                        name="other_subject"
                        id="id_other_subject"
                        value="{{ form.other_subject.value|default_if_none:'' }}"
                        class="w-full px-4 py-3 text-base placeholder:text-sm border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-blue-50/30"
                        placeholder="Write your subject"
                    >
                    {% if form.other_subject.errors %}
                        <p class="mt-1 text-xs text-red-600">{{ form.other_subject.errors.0 }}</p>
                    {% endif %}
                </div>

                <div>
                    <label for="id_message" class="block text-sm font-medium text-gray-700 mb-1">Message</label>
                    <textarea
                        name="message"
                        id="id_message"
                        rows="6"
                        required
                        class="w-full px-4 py-3 text-base placeholder:text-sm border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-blue-50/30"
                        placeholder="How can we help?"
                    >{{ form.message.value|default_if_none:'' }}</textarea>
                    {% if form.message.errors %}
                        <p class="mt-1 text-xs text-red-600">{{ form.message.errors.0 }}</p>
                    {% endif %}
                </div>

                {% if turnstile_enabled and turnstile_site_key %}
                    <div>
                        <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
                        <div class="cf-turnstile" data-sitekey="{{ turnstile_site_key }}"></div>
                    </div>
                {% endif %}

                <button type="submit" class="w-full bg-blue-600 text-white font-semibold px-4 py-3 rounded-lg hover:bg-blue-700 transition shadow-sm">
                    Send Message
                </button>

                <div class="text-center text-sm">
                    <a href="{% url 'calendar_app:home' %}" class="text-blue-600 hover:underline">Back to Home</a>
                </div>
            </form>

            <script>
                (function(){
                    const subject = document.getElementById('id_subject');
                    const wrap = document.getElementById('other-subject-wrap');
                    const other = document.getElementById('id_other_subject');
                    if (!subject || !wrap || !other) return;

                    function sync(){
                        const isOther = subject.value === 'other';
                        wrap.classList.toggle('hidden', !isOther);
                        other.required = isOther;
                        if (!isOther) other.value = '';
                    }
                    subject.addEventListener('change', sync);
                    // Initialize on load; if server returned errors, keep visible
                    sync();
                    if ((other.value || '').trim().length > 0) {
                        subject.value = 'other';
                        sync();
                    }
                })();
            </script>
        </div>
    </div>
</div>
{% endblock %}
